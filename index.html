<html>
  <head>
    <meta http-equiv="refresh" content="300">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  </head>
  <body style="text-align:center;background-color:black;overflow:hidden">
    <div id="timer">
    </div>
    <div id="currentTime">
    </div>
    <script>
      function dateStuff() {
        var offset= -8; //(Pacific Daylight Time)                                                                  
        // Check for DST
        var month = new Date().getMonth();
        var date = new Date().getDate();
        if (month > 2 && month < 10) {
          offset = -7;
        }
        else if (month == 2 && date >= 10) {
          offset = -7;
        }
        else if (month == 10 && date >= 4) {
          offset = -7;
        }
        var d = new Date( new Date().getTime() + offset * 3600 * 1000);
        return d;
      }

      function getImage() {
        $.get("http://192.168.1.33:8080/rand", function(res) {
          console.log(res);
          var imgUrl = "http://192.168.1.33:8080/images/" + res;

          var body = $(document.body);
          var img = $("<img class='slide' src='" + imgUrl +
                      "' style='display:none;position:absolute;top:0px;max-height:" + 
                      body.height() + ";max-width:" + body.width() + "'>");

          img.one("load", () => {
            var old = $(".slide");
            old.fadeOut({
                duration: 2000,
                queue:false,
                easing: "linear",
                done: () => {
                  old.remove();
                }
            });
        
            $(document.body).append(img.fadeIn({
              duration: 3000,
              easing: "linear",
              queue: false
            }).animate({
              left: body.width(),
            }, {
              duration: 30000,
              easing: "linear",
              queue:false
            }));
          });
        });
      }

      var timeLeft = 30;
      // Only do this when the computer boots.
      if (sessionStorage.firstLoad) {
        timeLeft = 0;
      }
      sessionStorage.firstLoad = true;

      var countDown = setInterval(() => {
        $("#timer").css({
          fontSize: 140,
          fontWeight: "bold",
          color: "white",
        }).text(timeLeft);
        timeLeft--;
      }, 1000);

      setTimeout(() => {
        clearInterval(timeLeft);
        $("#timer").remove();
        setInterval(getImage, 15000);
        getImage();
      }, timeLeft * 1000);

      setInterval(() => {
        var now = dateStuff();
        $("#currentTime").css({
          position:"absolute",
          bottom: 40,
          right: 40,
          fontSize: 100,
          fontWeight: "bold",
          color: "white",
          zIndex: 1000
        }).text(now.getHours() + ":" + now.getMinutes() + " " + now.getDate() + "/" + (now.getMonth()+1));
      }, 1000);

    </script>
  </body>
</html>
